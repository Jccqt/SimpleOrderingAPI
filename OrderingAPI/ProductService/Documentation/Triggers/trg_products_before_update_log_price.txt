DELIMITER $$

CREATE TRIGGER trg_products_before_update_log_price
BEFORE UPDATE ON products
FOR EACH ROW
BEGIN
	IF OLD.price <> NEW.price THEN
		INSERT INTO price_history(
			product_id,
			old_price,
			new_price,
			changed_at)
		VALUES(OLD.product_id,
			OLD.price,
			NEW.price,
			NOW());
	END IF;
END$$

DELIMITER ;